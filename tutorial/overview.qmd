---
title: "Overview of rTisane"
author: "Eunice Jun"
date: "December 2, 2022"
toc: true
format:
  html:
    html-math-method: katex
    code-tools: true
    self-contained: true
execute:
  warning: false
---

## Introduction 
Status check: At this point, you have successfully installed rTisane! If not, look at [the instructions for installing rTisane](tutorial/start.qmd) or [ask for help](https://github.com/emjun/rTisane/issues). 

In this part of the tutorial, you will use rTisane to author a statistical model without a priori knowing how exactly to formulate it. 

*How?* In five steps (!!!), rTisane will help you leverage what you know about how variables relate to one another conceptually in your domain and how you collected the data in order to figure out the mathematical formulation and output a script that implements the statistical model. 

## Step 1: Declare variables 
There are two kinds of variables in rTisane: (i) Units and (ii) Measures. 

Example: Consider a study about student test performance. You collect data from 100 students. For each student, you know their socioeconomic background and test score. You also randomly assign them to one of two conditions: online tutoring, in-person tutoring. 

### Units
Units are entities you collect data from through observation or experimentation. 

In the example, student is your unit. 

Units have
- `name`: the column name in the dataset
- `cardinality`: how many unique students you have
```{r}
student <- Unit(name="student", cardinality=100)
```

You could also consider each student a participant in your study and specify
```{r}
student <- Participant(name="student", cardinality=100)
```

*The above two are equivalent.* You should use whatever makes more sense to you. 

### Measures
Measures are attributes of a Unit you have observed and/or assigned them. Each measure can represent `numeric`, `nominal`, or `ordinal` data. 

Numeric data represent quantitative measures that are considered to be continuous (e.g., time, age).

In the example, test score is numeric. 

Numeric variables have 
- `unit`: the unit this measure describes
- `name`: the column name in the dataset
```{r}
testScore <- numeric(unit=student, name="testScore")
```

Nominal data have unordered categories (e.g., chocolate ice cream, vanilla ice cream, strawberry ice cream).
In the example, condition is nominal. 

Nominal variables have 
- `unit`: the unit this measure describes 
- `name`: the column name in the dataset
# TODO: nothing else?? 
```{r}
tutoring <- nominal(unit=student, name="condition")
```

Ordinal data have ordered categories (e.g., first grade, second grade, third grade).
In the example, socioeconomic background is ordinal. 

Ordinal variables have
- `unit`: the unit this measure describes 
- `name`: the column name in the dataset
- `order`: an ordering to the categorical values the variable could take on 
```{r}
ses <- ordinal(unit=student, name="SES", order=list("low", "middle", "high"))
```

Result: A set of variables you are thinking about and that you want to specify conceptual relationships for. Don't worry, you can always add more variables later!


#### Compound Measures 
TODO: ADD INTERACTS after write API overview!

## Step 2: Specify conceptual relationships 
To start, specify a conceptual model to add conceptual relationships to. The conceptual model is used to produce a statistical model. 
```{r}
cm <- ConceptualModel()
```

rTisane represents the conceptual model as a directed acyclic graph. The nodes are variables, and the edges describe how the variables relate to one another. For example, here is the conceptual node you will be asked to specify at the end of this section. 
# TODO: ADD PICTURE (Same one as later!)

There are **three different types of relationships (and edges)**. You should specify how variables relate according to what most closely represents your understanding. In the case of ambiguity when inferring a statistical model, rTisane will ask you follow-up questions. 

<!-- What happens if you specify a relationship?  -->

### WhenThen 
Use `whenThen` to specify how exactly a variable causes another. 

For example, you might want to say that when students receive in-person tutoring, their test scores increase. 
```{r}
whenThen(when=equals(tutoring, "in-person"), then=increases(testScore))
```

### Relates
Use `relates` when you want to note that two variables are related, but the direction of influence is unclear. 

For example, you could also say that tutoring is related to test scores. 
```{r}
relates(tutoring, testScore)
```

To infer a statistical model, rTisane will ask you to assume a direction. 

### Causes 
Use `causes` to specify that a variable causes another, but you do not know or want to specify how specific values of a variable influence another variable. 

For example, you might want to say that tutoring causes test scores. 
```{r}
causes(tutoring, testScore)
```
*When inferring statistical models, the above two statements are equivalent.*

Each edge also has one of two labels: assume or hypothesize. 

### Assume 
Assume a conceptual relationship if it is established in prior work and would be problematic if it did not exist in the current dataset. 

For example, you can say that based on prior work, you assume socioeconomic background will cause test scores. 
```{r}
cr <- causes(ses, testScore)
assume(cm, cr) # cm refers to the Conceptual Model you declared previously and are adding this relationship to
```

### Hypothesize 
Hypothesize a conceptual relationship if it is the focus of the ongoing analysis. **In order to infer a statistical model, there must be at least one hypothesized relationship.**

For example, you desigend the study so that each student was randomly assigned a tutoring condition. You hypothesize tutoring influences test scores. 
```{r}
cr <- causes(tutoring, testScore)
hypothesize(cm, cr) # cm refers to the Conceptual Model you declared previously and are adding this relationship to
```

> Try it out! In a separate `tutorial.R` script, write the other two relationships that would result in the conceptual model below. 
# TODO: Add picture + key below!

Result: Set of variables + conceptual relationships that represent your background knowledge about the domain. 

# FAQs
1. How do I know which conceptual relationships I specify? 
Reflect on what understanding of the domain you are bringing to data analysis. Express the type of relationships as what feels most accurate to your understanding. Label each relationship according to what you want to assume or hypothesize. 

2. What is the impact of specifying conceptual relationships? What happens if I omit a variable relationship? 
The conceptual relationships help rTisane infer a statistical model that most accurately represents your conceptual knowledge and understanding of the domain. If you omit a variable relationship, the statistical model may not be applicable because it does not capture your complete conceptual understanding. 

3. Can I go back and change my relationships? 
Yes! If you become aware of conceptual relationships as you use rTisane, you should go back and add new conceptual relationships and/or update ones you already specified. Query rTisane again with this updated conceptual model. 

## Step 3: Ask rTisane for a statistical model based on your variable relationships
Query rTisane for a statistical model estimating the infuence of a variable on a dependent variable based on the conceptual relationships specified in a conceptual model. 
```{r}
query(conceptualModel=cm, iv=tutoring, dv=testScore) # cm refers to the Conceptual Model you declared previously and are adding this relationship to
```
Note: **Data is not required in order to generate a statistical model.**
If you have data, pass its path to the query: 
```{r}
query(conceptualModel=cm, iv=tutoring, dv=testScore, data="data.csv")
```

At this point, :clap:! You have a complete rTisane program with variables, conceptual relationships, and a query for a statistical model!

## Step 4: Clarify any relationships + answer a few more targeted questions
rTisane will show you an overview of your conceptual model's graph. If you specified that a variable `relates` to another conceptually, rTisane will ask you to assume a specific direction of influence in order to infer a statistical model. For example: 
# TODO: image of first disambiguation phase!

Once you have finalized your conceptual model, rTisane will generate a space of valid statistical models and ask a few follow-up questions via a graphical user interface (GUI). The GUI will explain how rTisane determined which variables should be included in a linear model and what family and link options to pick among based on your variable data types. After answering all the questions, generate code to fit and summarize a statistical model!

For example: 
# TODO: Add gif of GUI for school tutoring! 

Result: A generated script with code for the resulting statistical model you can run! 

## Step 5: Run your statistical model!
Run the output script with data! 

If you did not specify data in your query, you will need to specify a data path in the script. So, open the script up in a code editor. Type in the path, as the comments instruct you, and then run it! 
# TODO: Record video showing me update the path!

If you specified data in your query, run the script! 
```{r}
source("model.R") # The output script will be called model.R, but you might have to find it's path/location on your computer. 
```
Result: Summary of your statistical model + a visualization for how well the data fit. 


# Tip: Use the pipe character for specifying your conceptual model! 
Consider the below rTisane program.
```{r}
student <- Unit(name="student", cardinality=100)
ses <- ordinal(unit=student, name="SES", order=list("low", "middle", "high"))
tutoring <- nominal(unit=student, name="condition")
testScore <- numeric(unit=student, name="testScore")

cm <- ConceptualModel() 

cr <- causes(ses, testScore)
cm <- assume(cm, cr)

cr <- whenThen(when=equals(tutoring, "in-person"), then=increases(testScore))
cm <- assume(cm, cr)

query(conceptualModel=cm, iv=tutoring, dv=testScore)
```
The above program is equivalent to this program: 
```{r}
student <- Unit(name="student", cardinality=100)
ses <- ordinal(unit=student, name="SES", order=list("low", "middle", "high"))
tutoring <- nominal(unit=student, name="condition")
testScore <- numeric(unit=student, name="testScore")

cm <- ConceptualModel() %>%
    assume(causes(ses, testScore)) %>%
    assume(whenThen(when=equals(tutoring, "in-person"), then=increases(testScore))) %>%
    query(iv=tutoring, dv=testScore)
```
By using the "piping" idiom common in R, the second program emphasizes that the conceptual model is driving the statistical modeling process. You may also find the second program easier to read and write.